{"componentChunkName":"component---src-templates-blog-template-js","path":"/records-cgv-open-push/","result":{"data":{"cur":{"id":"27107e10-85d3-52f8-9413-7f367418bc12","html":"<p>See this project on Github 👉 <a href=\"https://github.com/0w0i0n0g0/cgv-open-push\" target=\"_blank\">Link</a></p>\n<h2 id=\"-개요\" style=\"position:relative;\"><a href=\"#-%EA%B0%9C%EC%9A%94\" aria-label=\" 개요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📚 개요</h2>\n<ul>\n<li>\n<p>CGV 예매 오픈 알리미</p>\n</li>\n<li>\n<p>제작 기간 : 2024/3/2 ~ 2024/3/11 ~ 유지보수 중</p>\n</li>\n<li>\n<p>라즈베리파이로 운영한 기간 : 2024/3/2 ~ 2024/6/3</p>\n</li>\n<li>\n<p>Docker Container로 운영한 기간 : 2024/6/3 ~ 운영 중</p>\n</li>\n</ul>\n<h2 id=\"-제작-동기\" style=\"position:relative;\"><a href=\"#-%EC%A0%9C%EC%9E%91-%EB%8F%99%EA%B8%B0\" aria-label=\" 제작 동기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🏁 제작 동기</h2>\n<p>우리나라 단연 최고의 영화관이라고 할 수 있는 CGV 용산아이파크몰 IMAX관.</p>\n<p>그러나 1.43:1 비율의 IMAX GT 비율의 영화가 개봉한다고 하면 새벽과 심야 시간 때까지 매진 행렬이 이어진다.</p>\n<p>나도 좀 편하게 명당자리에서 보고 싶어서 예매가 오픈되었을 때 알림을 보내주는 프로그램을 만들기로 하였다.</p>\n<h2 id=\"-영화-예매-정보-가져오기\" style=\"position:relative;\"><a href=\"#-%EC%98%81%ED%99%94-%EC%98%88%EB%A7%A4-%EC%A0%95%EB%B3%B4-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0\" aria-label=\" 영화 예매 정보 가져오기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📑 영화 예매 정보 가져오기</h2>\n<p>처음에는 Selenium이나 Beautiful Soup 같은 것으로 크롤링, 스크래핑을 하려고 했지만 몇 번 시도해 보다가 변수가 너무 많았고, 구현하고자 하는 목적에 맞는 방법이 아니라고 생각이 들어 개발자 도구로 CGV 홈페이지를 뜯어보기 시작했다.</p>\n<h3 id=\"사이트-분석\" style=\"position:relative;\"><a href=\"#%EC%82%AC%EC%9D%B4%ED%8A%B8-%EB%B6%84%EC%84%9D\" aria-label=\"사이트 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>사이트 분석</h3>\n<p>개발자 도구를 통해 요청을 몇 번 보내보니 <code class=\"language-text\">http://ticket.cgv.co.kr/CGV2011/RIA/CJ000.aspx/CJ_TICKET_SCHEDULE_TOTAL_PLAY_YMD</code> 와 같은 곳으로 json 데이터로 검색 필터를 설정할 값을 전송하는 것을 확인했다.</p>\n<p>다만 이 데이터들은 AES 암호화되어 있어, 원래 값을 정확하게 알 순 없었지만, 그 값들의 원래 뜻은 json의 key값을 통해 유추할 수 있었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># 듄-파트2 용산아이파크몰 IMAX관의 예매 정보를 가져올 때 전송하는 json 값</span>\r\n    <span class=\"token punctuation\">{</span>\r\n        <span class=\"token string\">\"REQSITE\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"x02PG4EcdFrHKluSEQQh4A==\"</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token string\">\"TheaterCd\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"LMP+XuzWskJLFG41YQ7HGA==\"</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token string\">\"ISNormal\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3y+GIXzg3xKpOjlKjH8+Fg==\"</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token string\">\"MovieGroupCd\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"bNQovwyoamC5EsbGvSDIqw==\"</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token string\">\"ScreenRatingCd\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"nG6tVgEQPGU2GvOIdnwTjg==\"</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token string\">\"MovieTypeCd\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/Saxvehmz4RPKZDKNMvSKQ==\"</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token string\">\"Subtitle_CD\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"nG6tVgEQPGU2GvOIdnwTjg==\"</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token string\">\"SOUNDX_YN\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"nG6tVgEQPGU2GvOIdnwTjg==\"</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token string\">\"Third_Attr_CD\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"nG6tVgEQPGU2GvOIdnwTjg==\"</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token string\">\"Language\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"zqWM417GS6dxQ7CIf65+iA==\"</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<h3 id=\"가져온-영화-예매-정보-분석\" style=\"position:relative;\"><a href=\"#%EA%B0%80%EC%A0%B8%EC%98%A8-%EC%98%81%ED%99%94-%EC%98%88%EB%A7%A4-%EC%A0%95%EB%B3%B4-%EB%B6%84%EC%84%9D\" aria-label=\"가져온 영화 예매 정보 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>가져온 영화 예매 정보 분석</h3>\n<p>위의 json 데이터를 post로 전송하면 다음과 같은 형식의 영화 예매 정보 xml 파일을 받을 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CSchedule</span><span class=\"token punctuation\">></span></span>\r\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>PlayDays</span><span class=\"token punctuation\">></span></span>\r\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CPlayDay</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>PLAY_YMD</span><span class=\"token punctuation\">></span></span>20240331<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>PLAY_YMD</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>FORMAT_DATE</span><span class=\"token punctuation\">></span></span>2024년03월31일(일)<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>FORMAT_DATE</span><span class=\"token punctuation\">></span></span>\r\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CPlayDay</span><span class=\"token punctuation\">></span></span>\r\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>PlayDays</span><span class=\"token punctuation\">></span></span>\r\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Movies</span><span class=\"token punctuation\">></span></span>\r\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMovie</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>GROUP_CD</span><span class=\"token punctuation\">></span></span>20035290<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>GROUP_CD</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>GROUP_NM</span><span class=\"token punctuation\">></span></span>듄-파트2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>GROUP_NM</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>MOVIE_CD</span><span class=\"token punctuation\">></span></span>20035760<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>MOVIE_CD</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>RATING_CD</span><span class=\"token punctuation\">></span></span>03<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>RATING_CD</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>PLATFORM_CD</span><span class=\"token punctuation\">></span></span>02<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>PLATFORM_CD</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>TRANS_CD</span><span class=\"token punctuation\">></span></span>02<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>TRANS_CD</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>PLATFORM_ATTR_CD</span><span class=\"token punctuation\">></span></span>04<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>PLATFORM_ATTR_CD</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>SUBTITLE_CD</span> <span class=\"token punctuation\">/></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>SUBTITLE_NM</span> <span class=\"token punctuation\">/></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>MOVIE_COLLAGE_YN</span><span class=\"token punctuation\">></span></span>N<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>MOVIE_COLLAGE_YN</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>TICKET_RATE</span><span class=\"token punctuation\">></span></span>9.14<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>TICKET_RATE</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>STAR_POINT</span><span class=\"token punctuation\">></span></span>96.00<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>STAR_POINT</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>SOUNDX_YN</span><span class=\"token punctuation\">></span></span>N<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>SOUNDX_YN</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>THIRD_ATTR_CD</span> <span class=\"token punctuation\">/></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>THIRD_ATTR_NM</span><span class=\"token punctuation\">></span></span>0000000909<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>THIRD_ATTR_NM</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>MOVIE_ATTR_CD</span><span class=\"token punctuation\">></span></span>04<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>MOVIE_ATTR_CD</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>MOVIE_ATTR_NM</span><span class=\"token punctuation\">></span></span>IMAX<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>MOVIE_ATTR_NM</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>MOVIE_PKG_YN</span><span class=\"token punctuation\">></span></span>N<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>MOVIE_PKG_YN</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>MOVIE_NOSHOW_YN</span><span class=\"token punctuation\">></span></span>N<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>MOVIE_NOSHOW_YN</span><span class=\"token punctuation\">></span></span>\r\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMovie</span><span class=\"token punctuation\">></span></span>\r\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Movies</span><span class=\"token punctuation\">></span></span>\r\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>GroupMovies</span><span class=\"token punctuation\">></span></span>\r\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CGroupMovie</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>MOVIE_CD_GROUP</span><span class=\"token punctuation\">></span></span>20035290<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>MOVIE_CD_GROUP</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>MOVIE_GROUP_NM</span><span class=\"token punctuation\">></span></span>듄-파트2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>MOVIE_GROUP_NM</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>TICKET_RATE</span><span class=\"token punctuation\">></span></span>9.14<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>TICKET_RATE</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>STAR_POINT</span><span class=\"token punctuation\">></span></span>96.00<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>STAR_POINT</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>RATING_CD</span><span class=\"token punctuation\">></span></span>03<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>RATING_CD</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>POSTER</span><span class=\"token punctuation\">></span></span>http://img.cgv.co.kr/Movie/Thumbnail/Poster/000087/87947/87947_185.JPG<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>POSTER</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>MOVIE_IDX</span><span class=\"token punctuation\">></span></span>87947<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>MOVIE_IDX</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>MOVIE_PKG_YN</span><span class=\"token punctuation\">></span></span>N<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>MOVIE_PKG_YN</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>MOVIE_NOSHOW_YN</span> <span class=\"token punctuation\">/></span></span>\r\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CGroupMovie</span><span class=\"token punctuation\">></span></span>\r\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>STheaters</span><span class=\"token punctuation\">></span></span>\r\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CSTheater</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>THEATER_CD</span><span class=\"token punctuation\">></span></span>0013<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>THEATER_CD</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>THEATER_NM</span><span class=\"token punctuation\">></span></span>CGV 용산아이파크몰<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>THEATER_NM</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>AREA_CD</span><span class=\"token punctuation\">></span></span>13<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>AREA_CD</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>RATING_CD</span><span class=\"token punctuation\">></span></span>02<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>RATING_CD</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>DIRECT_RELATED_YN</span><span class=\"token punctuation\">></span></span>Y<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>DIRECT_RELATED_YN</span><span class=\"token punctuation\">></span></span>\r\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CSTheater</span><span class=\"token punctuation\">></span></span>\r\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>STheaters</span><span class=\"token punctuation\">></span></span>\r\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Screen</span><span class=\"token punctuation\">></span></span>\r\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CScreen</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>RATING_CD</span><span class=\"token punctuation\">></span></span>02<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>RATING_CD</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>RATING_NM</span><span class=\"token punctuation\">></span></span>아이맥스<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>RATING_NM</span><span class=\"token punctuation\">></span></span>\r\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CScreen</span><span class=\"token punctuation\">></span></span>\r\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Screen</span><span class=\"token punctuation\">></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CSchedule</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>여기서 집중할 것은 상영일인 <code class=\"language-text\">PlayDays</code>이다.</p>\n<p>여기에 날짜가 추가될 때 알림을 보내면 된다.</p>\n<h2 id=\"️-예매-오픈을-확인할-메인-로직\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-%EC%98%88%EB%A7%A4-%EC%98%A4%ED%94%88%EC%9D%84-%ED%99%95%EC%9D%B8%ED%95%A0-%EB%A9%94%EC%9D%B8-%EB%A1%9C%EC%A7%81\" aria-label=\"️ 예매 오픈을 확인할 메인 로직 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>♾️ 예매 오픈을 확인할 메인 로직</h2>\n<p>요청을 일정 주기마다 넣어서 받은 영화 예매 정보 xml이 바뀌는지 확인하고, 여기서 날짜가 추가되면 알림을 보내는 방식으로 만들었다.</p>\n<h3 id=\"기준-값-초기화하기\" style=\"position:relative;\"><a href=\"#%EA%B8%B0%EC%A4%80-%EA%B0%92-%EC%B4%88%EA%B8%B0%ED%99%94%ED%95%98%EA%B8%B0\" aria-label=\"기준 값 초기화하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>기준 값 초기화하기</h3>\n<p>먼저 기준 값을 <code class=\"language-text\">response1</code>으로 정해서 응답을 받아 저장한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">response1 <span class=\"token operator\">=</span> extract_playdays<span class=\"token punctuation\">(</span>get_request_to_cgv_api<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> cookies<span class=\"token punctuation\">,</span> headers<span class=\"token punctuation\">,</span> json_data<span class=\"token punctuation\">,</span> target_name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\nresponse2 <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span></code></pre></div>\n<h3 id=\"변경사항-찾기\" style=\"position:relative;\"><a href=\"#%EB%B3%80%EA%B2%BD%EC%82%AC%ED%95%AD-%EC%B0%BE%EA%B8%B0\" aria-label=\"변경사항 찾기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>변경사항 찾기</h3>\n<p><code class=\"language-text\">response2</code>에 일정 시간마다 갱신된 예매 정보를 저장하여 <code class=\"language-text\">response1</code>과 비교하고, 변경사항을 찾는다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token comment\"># 5초마다 예매 정보 불러오기</span>\r\n  time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span>\r\n  <span class=\"token comment\"># 2번에 새 응답 저장</span>\r\n  response2 <span class=\"token operator\">=</span> extract_playdays<span class=\"token punctuation\">(</span>get_request_to_cgv_api<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> cookies<span class=\"token punctuation\">,</span> headers<span class=\"token punctuation\">,</span> json_data<span class=\"token punctuation\">,</span> target_name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n\r\n  <span class=\"token comment\"># 새 응답과 저장된 이전 응답이 다르다면</span>\r\n  <span class=\"token keyword\">if</span> response1 <span class=\"token operator\">!=</span> response2<span class=\"token punctuation\">:</span>\r\n      dmp <span class=\"token operator\">=</span> diff_match_patch<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token comment\"># diff에 응답끼리 다른 부분을 추출 {(-1, \"삭제된 부분\"), (1, \"추가된 부분\")}</span>\r\n      diff <span class=\"token operator\">=</span> dmp<span class=\"token punctuation\">.</span>diff_main<span class=\"token punctuation\">(</span>response1<span class=\"token punctuation\">,</span> response2<span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"예매-오픈-푸시-알림-전송하기\" style=\"position:relative;\"><a href=\"#%EC%98%88%EB%A7%A4-%EC%98%A4%ED%94%88-%ED%91%B8%EC%8B%9C-%EC%95%8C%EB%A6%BC-%EC%A0%84%EC%86%A1%ED%95%98%EA%B8%B0\" aria-label=\"예매 오픈 푸시 알림 전송하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>예매 오픈 푸시 알림 전송하기</h3>\n<p><code class=\"language-text\">added_result</code>에 추가된 변경사항을 모두 문자열로 저장하고, 예매 오픈 푸시 알림을 전송한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">for</span> d <span class=\"token keyword\">in</span> diff<span class=\"token punctuation\">:</span>\r\n  <span class=\"token comment\">## d[0]가 1이면 추가된 요소</span>\r\n  <span class=\"token keyword\">if</span> d<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\r\n          added_result <span class=\"token operator\">+=</span> extract_text_between_tag<span class=\"token punctuation\">(</span>d<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"FORMAT_DATE\"</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token keyword\">except</span><span class=\"token punctuation\">:</span>\r\n          added_result <span class=\"token operator\">+=</span> d<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\\n\"</span>\r\n\r\n<span class=\"token comment\">#추가된 요소가 있으면</span>\r\n<span class=\"token keyword\">if</span> added_result <span class=\"token operator\">!=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token comment\"># 추가된 변경사항 푸시알림 보내기</span>\r\n  <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\r\n      send_open_push<span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>added_result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> target_name<span class=\"token punctuation\">)</span>\r\n  <span class=\"token keyword\">except</span> Exception <span class=\"token keyword\">as</span> e<span class=\"token punctuation\">:</span>\r\n      logging<span class=\"token punctuation\">.</span>error<span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>target_name<span class=\"token punctuation\">}</span></span><span class=\"token string\"> error when sending open push : </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>e<span class=\"token punctuation\">}</span></span><span class=\"token string\">'</span></span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"업데이트-특별관-예매-오픈을-확인하자\" style=\"position:relative;\"><a href=\"#%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8-%ED%8A%B9%EB%B3%84%EA%B4%80-%EC%98%88%EB%A7%A4-%EC%98%A4%ED%94%88%EC%9D%84-%ED%99%95%EC%9D%B8%ED%95%98%EC%9E%90\" aria-label=\"업데이트 특별관 예매 오픈을 확인하자 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(업데이트) 특별관 예매 오픈을 확인하자!</h3>\n<p>위의 코드로는 특정한 영화 하나에 대해서만 예매 오픈 확인을 할 수 있다.</p>\n<p>여기서 조금 더 확장하여 인기가 좋은 특별관에 대해서 예매 오픈 알림을 받아보고 싶었다.</p>\n<p>그래서 위의 예매 오픈 확인 로직을 조금 변경하여 특정한 영화가 아니라 특정한 상영관에 대해서 예매 오픈을 확인해보려고 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># 용산아이파크몰 IMAX관</span>\r\n<span class=\"token punctuation\">{</span>\r\n    <span class=\"token string\">'REQSITE'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'x02PG4EcdFrHKluSEQQh4A=='</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">'TheaterCd'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'LMP+XuzWskJLFG41YQ7HGA=='</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">'ISNormal'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'ECFppiyFz/nvSGsg7VwPQw=='</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">'MovieGroupCd'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'nG6tVgEQPGU2GvOIdnwTjg=='</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">'ScreenRatingCd'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'kXwoR3tnLM/+Tu0BILP3Qg=='</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">'MovieTypeCd'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'nG6tVgEQPGU2GvOIdnwTjg=='</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">'Subtitle_CD'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'nG6tVgEQPGU2GvOIdnwTjg=='</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">'SOUNDX_YN'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'nG6tVgEQPGU2GvOIdnwTjg=='</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">'Third_Attr_CD'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'nG6tVgEQPGU2GvOIdnwTjg=='</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">'Language'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'zqWM417GS6dxQ7CIf65+iA=='</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>위와 같은 json 데이터로 요청을 하면 용산아이파크몰 IMAX관에서 상영하는 모든 영화에 대한 응답이 온다.</p>\n<p>그 데이터들을 위의 로직과 유사하게 이전 응답과 바뀐 부분을 감지하여 예매 오픈을 확인할 수 있다.</p>\n<p>다만 이전에는 한 영화에 대한 응답만 오기 때문에 PlayDays만 추출하여 비교하면 됐지만, 이젠 그 상영관에서 상영하는 모든 영화에 대한 정보들이 오게 된다.</p>\n<p>그러면 예매 오픈과 무관한 불필요한 정보들이 변경될 때도 알림이 올 수 있기 때문에, 예매 오픈 확인에 꼭 필요한 부분만 남기고 삭제하는 전처리 과정이 필요하여 다음과 같이 처리했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># cgv_open_push_function.py</span>\r\n<span class=\"token comment\"># 특별관 예매 오픈 알림에 필요 없는 태그 제거하기</span>\r\n<span class=\"token keyword\">def</span> <span class=\"token function\">screen_remove_useless_tags</span><span class=\"token punctuation\">(</span>xml_string<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    useless_tags <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"PLAY_YMD\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"GROUP_CD\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"MOVIE_CD\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"RATING_CD\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"PLATFORM_CD\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"TRANS_CD\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"PLATFORM_ATTR_CD\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"MOVIE_COLLAGE_YN\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"TICKET_RATE\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"STAR_POINT\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"SOUNDX_YN\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"THIRD_ATTR_CD\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"MOVIE_ATTR_CD\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"MOVIE_PKG_YN\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"MOVIE_NOSHOW_YN\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"POSTER\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"MOVIE_IDX\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"THIRD_ATTR_NM\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">}</span>\r\n    <span class=\"token keyword\">for</span> tag <span class=\"token keyword\">in</span> useless_tags<span class=\"token punctuation\">:</span>\r\n        xml_string <span class=\"token operator\">=</span> remove_text_between_tag<span class=\"token punctuation\">(</span>xml_string<span class=\"token punctuation\">,</span> tag<span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">return</span> xml_string\r\n\r\n<span class=\"token comment\"># cgv_open_push_screen.py</span>\r\n<span class=\"token comment\"># 불필요한 부분 삭제</span>\r\nresponse1 <span class=\"token operator\">=</span> screen_remove_useless_tags<span class=\"token punctuation\">(</span>response1<span class=\"token punctuation\">)</span>\r\nresponse2 <span class=\"token operator\">=</span> screen_remove_useless_tags<span class=\"token punctuation\">(</span>response2<span class=\"token punctuation\">)</span></code></pre></div>\n<p>이제 이렇게 처리된 두 문자열을 비교하는 방식으로 특정한 상영관에 대해서 모두 예매 오픈 알림을 받을 수 있게 되었다!</p>\n<h2 id=\"-메인-로직을-247-실행하기\" style=\"position:relative;\"><a href=\"#-%EB%A9%94%EC%9D%B8-%EB%A1%9C%EC%A7%81%EC%9D%84-247-%EC%8B%A4%ED%96%89%ED%95%98%EA%B8%B0\" aria-label=\" 메인 로직을 247 실행하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🏪 메인 로직을 24/7 실행하기</h2>\n<h3 id=\"여러-영화들에-대해서-확인하기\" style=\"position:relative;\"><a href=\"#%EC%97%AC%EB%9F%AC-%EC%98%81%ED%99%94%EB%93%A4%EC%97%90-%EB%8C%80%ED%95%B4%EC%84%9C-%ED%99%95%EC%9D%B8%ED%95%98%EA%B8%B0\" aria-label=\"여러 영화들에 대해서 확인하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>여러 영화들에 대해서 확인하기</h3>\n<p>다음과 같은 방법으로 입력된 <code class=\"language-text\">json_data</code>에 대해 메인 로직을 쓰레드로 동시에 모두 실행시킬 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">for</span> data <span class=\"token keyword\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span>json_data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    t <span class=\"token operator\">=</span> threading<span class=\"token punctuation\">.</span>Thread<span class=\"token punctuation\">(</span>target<span class=\"token operator\">=</span>main<span class=\"token punctuation\">,</span> args<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> cookies<span class=\"token punctuation\">,</span> headers<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> target_name<span class=\"token punctuation\">[</span>data<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n    t<span class=\"token punctuation\">.</span>start<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"예외-발생-시-예외-처리\" style=\"position:relative;\"><a href=\"#%EC%98%88%EC%99%B8-%EB%B0%9C%EC%83%9D-%EC%8B%9C-%EC%98%88%EC%99%B8-%EC%B2%98%EB%A6%AC\" aria-label=\"예외 발생 시 예외 처리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>예외 발생 시 예외 처리</h3>\n<p>메인 로직 실행 중에 예외가 발생된다면, 발생한 오류를 푸시 알림으로 전송하고, 로그를 남긴다.</p>\n<p>그리고 해당 파이썬 프로그램을 다시 실행한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">except</span> Exception <span class=\"token keyword\">as</span> e<span class=\"token punctuation\">:</span>\r\n    send_push_to_ntfy<span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>target_name<span class=\"token punctuation\">}</span></span><span class=\"token string\">\\n서버에서 오류 발생🚨\\n</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>e<span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">,</span> target_name<span class=\"token punctuation\">)</span>\r\n    send_push_to_private_ntfy<span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>target_name<span class=\"token punctuation\">}</span></span><span class=\"token string\">\\n서버에서 오류 발생🚨\\n</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>e<span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">,</span> target_name<span class=\"token punctuation\">)</span>\r\n    logging<span class=\"token punctuation\">.</span>error<span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>target_name<span class=\"token punctuation\">}</span></span><span class=\"token string\"> error : </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>e<span class=\"token punctuation\">}</span></span><span class=\"token string\">'</span></span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token comment\"># 다시 실행</span>\r\n    os<span class=\"token punctuation\">.</span>execl<span class=\"token punctuation\">(</span>sys<span class=\"token punctuation\">.</span>executable<span class=\"token punctuation\">,</span> sys<span class=\"token punctuation\">.</span>executable<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>sys<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"-알림-보내기\" style=\"position:relative;\"><a href=\"#-%EC%95%8C%EB%A6%BC-%EB%B3%B4%EB%82%B4%EA%B8%B0\" aria-label=\" 알림 보내기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🔔 알림 보내기</h2>\n<h3 id=\"ntfy\" style=\"position:relative;\"><a href=\"#ntfy\" aria-label=\"ntfy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ntfy</h3>\n<p>ntfy라는 오픈소스 프로젝트를 사용하여 거의 모든 운영체제에 손쉽게 푸시 알림을 보낼 수 있다.</p>\n<p>알림 권한을 직접 설정하고, 오류 대처도 빠르게 하기 위해서 라즈베리파이로 직접 ntfy 서버까지 설치하여 호스팅 했다.</p>\n<blockquote>\n<p>참고 사이트</p>\n<ul>\n<li><a href=\"https://docs.ntfy.sh/install/\">https://docs.ntfy.sh/install/</a></li>\n<li><a href=\"https://docs.ntfy.sh/config/\">https://docs.ntfy.sh/config/</a></li>\n</ul>\n</blockquote>\n<h3 id=\"업데이트-docker로-운영하기\" style=\"position:relative;\"><a href=\"#%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8-docker%EB%A1%9C-%EC%9A%B4%EC%98%81%ED%95%98%EA%B8%B0\" aria-label=\"업데이트 docker로 운영하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(업데이트) Docker로 운영하기</h3>\n<p>서버를 이전하면서 ntfy도 Docker로 운영하게 되었다.</p>\n<h2 id=\"-서버-상태-확인-페이지\" style=\"position:relative;\"><a href=\"#-%EC%84%9C%EB%B2%84-%EC%83%81%ED%83%9C-%ED%99%95%EC%9D%B8-%ED%8E%98%EC%9D%B4%EC%A7%80\" aria-label=\" 서버 상태 확인 페이지 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🔋 서버 상태 확인 페이지</h2>\n<p>24시간 동안 계속 동작해야 하고, 서버에 오류가 생기거나 다운되었을 때, 이를 쉽게 확인할 방법이 필요했다.</p>\n<p>Python 마이크로 웹 프레임워크인 Flask를 통해 간단하게 서버 상태 확인 페이지를 만들었다.</p>\n<p>이 페이지에는 하루 활성 사용자 수와 인터넷에 연결되어 있는 구독자 수, 서버의 Health Check 그리고 서버 로그의 일부분을 표시한다.</p>\n<p>하루 활성 사용자 수 (Daily Active Users : DAU)와 인터넷에 연결되어 있는 구독자 수(Online Subscribers)는 ntfy의 metrics에서 제공하는 통계에서 제공한다.</p>\n<p>Health Check는 마지막으로 예매 정보를 받은 시간과 현재 시간과의 차이를 통해 그 시간의 차이가 3초와 비교했을 때 얼마나 차이가 나냐를 기준으로 바 형태의 그래프로 표시하고, 차이가 5초 이상이면 빨간색으로 바뀌며 서버의 상태를 표시하게 했다.</p>\n<p>그래프의 길이와 색을 통해 서버가 잘 동작하고 있는지 쉽게 판단할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span>Server Health Check<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>health-check<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\r\n         <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>progress</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">'</span>3<span class=\"token punctuation\">'</span></span> <span class=\"token attr-name\">max</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">'</span>{time_diff}<span class=\"token punctuation\">'</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>progress</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>서버 로그는 제일 마지막 줄부터 10줄을 불러와서 제공한다. 즉, 최신 로그 10개를 표시하게 된다.</p>\n<h3 id=\"결과\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EA%B3%BC\" aria-label=\"결과 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결과</h3>\n<p>서버를 이전하기 전 마지막 화면이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 216.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"server-status-page.png\"\n        title=\"server-status-page.png\"\n        src=\"/static/eea3cdad09bc5aff83e9efb41c2a175f/37523/server-status-page.png\"\n        srcset=\"/static/eea3cdad09bc5aff83e9efb41c2a175f/e9ff0/server-status-page.png 180w,\n/static/eea3cdad09bc5aff83e9efb41c2a175f/f21e7/server-status-page.png 360w,\n/static/eea3cdad09bc5aff83e9efb41c2a175f/37523/server-status-page.png 720w,\n/static/eea3cdad09bc5aff83e9efb41c2a175f/302a4/server-status-page.png 1080w,\n/static/eea3cdad09bc5aff83e9efb41c2a175f/60b3a/server-status-page.png 1179w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"업데이트-서버-이전-이후\" style=\"position:relative;\"><a href=\"#%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8-%EC%84%9C%EB%B2%84-%EC%9D%B4%EC%A0%84-%EC%9D%B4%ED%9B%84\" aria-label=\"업데이트 서버 이전 이후 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(업데이트) 서버 이전 이후…</h3>\n<p>현재는 활성 구독자수만 집계하여 표시하고 있다.</p>\n<p>또한 전체 로그는 Docker로 관리하게 되어서, 이 페이지에는 cgv에 요청한 로그들만 출력하고 있다.</p>\n<h2 id=\"️-서버-운영-및-성과\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-%EC%84%9C%EB%B2%84-%EC%9A%B4%EC%98%81-%EB%B0%8F-%EC%84%B1%EA%B3%BC\" aria-label=\"️ 서버 운영 및 성과 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🖥️ 서버 운영 및 성과</h2>\n<h3 id=\"자동-실행-설정하기\" style=\"position:relative;\"><a href=\"#%EC%9E%90%EB%8F%99-%EC%8B%A4%ED%96%89-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\" aria-label=\"자동 실행 설정하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>자동 실행 설정하기</h3>\n<p>라즈베리파이를 부팅할 때 자동으로 CGV 예매 오픈 알리미가 동작하도록 설정했다.</p>\n<p>먼저 <code class=\"language-text\">/etc/xdg/lxsession/LXDE-pi/autostart</code>에 <code class=\"language-text\">@bash /home/pi/afterstart.sh</code>를 추가한다.</p>\n<p>그리고 <code class=\"language-text\">afterstart.sh</code>를 다음과 같이 작성해주었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">(</span>메인 파일 실행<span class=\"token punctuation\">)</span>\r\npython cgv_open_push_main.py <span class=\"token operator\">&amp;</span>\r\n<span class=\"token punctuation\">(</span>서버 상태 확인 페이지 실행<span class=\"token punctuation\">)</span>\r\npython cgv_open_push_status.py <span class=\"token operator\">&amp;</span>\r\n<span class=\"token punctuation\">(</span>ntfy 실행 확인<span class=\"token punctuation\">)</span>\r\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'raspberry'</span> <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> <span class=\"token parameter variable\">-S</span> ntfy serve\r\n<span class=\"token punctuation\">(</span>prometheus 실행<span class=\"token punctuation\">)</span>\r\n<span class=\"token builtin class-name\">cd</span> prometheus\r\n./prometheus --web.listen-address<span class=\"token operator\">=</span>:9010</code></pre></div>\n<h3 id=\"보안-설정하기\" style=\"position:relative;\"><a href=\"#%EB%B3%B4%EC%95%88-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\" aria-label=\"보안 설정하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>보안 설정하기</h3>\n<p>최소한의 외부 공격과 보안을 위해서 Router 단에서 해외 IP를 차단했다.</p>\n<p>보안상 노출되면 안되는 ssh 포트 및 Admin용 관리 페이지와 연결되는 포트는 모두 내부망에만 존재하고, 포트포워딩을 통해 외부망으로는 ntfy 알림 서버 포트와 서버 상태 확인 페이지 포트만 연결하였다.</p>\n<p>또한 ntfy에서 자체적으로 Go의 rate package으로 token bucket을 활용하여 rate limit을 둔다.</p>\n<h3 id=\"업데이트-docker-활용하기\" style=\"position:relative;\"><a href=\"#%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8-docker-%ED%99%9C%EC%9A%A9%ED%95%98%EA%B8%B0\" aria-label=\"업데이트 docker 활용하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(업데이트) Docker 활용하기</h3>\n<p>라즈베리파이에 서버를 구동하니, 코드를 수정할 때마다 배포하는 것이 너무 불편하였고, 성능이 받쳐주지 못해서 툭하면 뻗는 문제가 있었다.</p>\n<p>그래서 아예 미니 PC로 서버를 구축해서 Docker Container로 올리기로 결정했다.</p>\n<p>서버 구축 내용은 여기서 볼 수 있다.</p>\n<p>다음과 같이 Dockerfile을 만들었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"docker\"><pre class=\"language-docker\"><code class=\"language-docker\"><span class=\"token instruction\"><span class=\"token keyword\">FROM</span> python:3.10</span>\r\n\r\n<span class=\"token instruction\"><span class=\"token keyword\">LABEL</span> name=<span class=\"token string\">\"cgv-open-push\"</span></span>\r\n\r\n<span class=\"token instruction\"><span class=\"token keyword\">WORKDIR</span> /</span>\r\n\r\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> * .</span>\r\n\r\n<span class=\"token comment\"># ntfy token e.g. \"Bearer tk_abcdefghijklmnopqrstuvwxyz\"</span>\r\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> NTFY_TOKEN=<span class=\"token string\">\"\"</span></span>\r\n<span class=\"token comment\"># private ntfy server address e.g. \"https://ntfy.sh\"</span>\r\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> PRIVATE_NTFY_SERVER_ADDRESS=<span class=\"token string\">\"\"</span></span>\r\n<span class=\"token comment\"># private ntfy prometheus address e.g. \"https://ntfy.sh/metrics\"</span>\r\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> PRIVATE_NTFY_PROMETHEUS_ADDRESS=<span class=\"token string\">\"\"</span></span>\r\n\r\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> pip install -r requirements.txt</span>\r\n\r\n<span class=\"token instruction\"><span class=\"token keyword\">ENTRYPOINT</span> [<span class=\"token string\">\"python\"</span>]</span>\r\n<span class=\"token instruction\"><span class=\"token keyword\">CMD</span> [<span class=\"token string\">\"cgv_open_push_main.py\"</span>]</span>\r\n\r\n<span class=\"token instruction\"><span class=\"token keyword\">EXPOSE</span> 5000</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># requirements.txt</span>\r\ndiff_match_patch<span class=\"token operator\">==</span><span class=\"token number\">20230430</span>\r\nFlask<span class=\"token operator\">==</span><span class=\"token number\">3.0</span><span class=\"token number\">.3</span>\r\nRequests<span class=\"token operator\">==</span><span class=\"token number\">2.32</span><span class=\"token number\">.2</span></code></pre></div>\n<p>이제 도커 이미지를 빌드해서 서버에서 컨테이너만 새 이미지로 재시작하면 서버를 무중단 운영할 수 있게 되었다!</p>\n<h2 id=\"-예매-오픈-알림을-받았다\" style=\"position:relative;\"><a href=\"#-%EC%98%88%EB%A7%A4-%EC%98%A4%ED%94%88-%EC%95%8C%EB%A6%BC%EC%9D%84-%EB%B0%9B%EC%95%98%EB%8B%A4\" aria-label=\" 예매 오픈 알림을 받았다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>⏰ 예매 오픈 알림을 받았다!</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 202.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"got-notification.png\"\n        title=\"got-notification.png\"\n        src=\"/static/f1f903e39b10b1427a1639e51a6adbde/37523/got-notification.png\"\n        srcset=\"/static/f1f903e39b10b1427a1639e51a6adbde/e9ff0/got-notification.png 180w,\n/static/f1f903e39b10b1427a1639e51a6adbde/f21e7/got-notification.png 360w,\n/static/f1f903e39b10b1427a1639e51a6adbde/37523/got-notification.png 720w,\n/static/f1f903e39b10b1427a1639e51a6adbde/302a4/got-notification.png 1080w,\n/static/f1f903e39b10b1427a1639e51a6adbde/cad6c/got-notification.png 1339w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>알림이 잘 와서 영화를 빠르게 예매할 수 있었다.</p>\n<h2 id=\"-마무리\" style=\"position:relative;\"><a href=\"#-%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\" 마무리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🔖 마무리</h2>\n<p>덕분에 명당에서 영화를 볼 수 있었고, 나뿐만이 아니라 이걸로 알림을 받아서 재미있게 보고 왔다고 해주시는 분들도 감사했다.</p>\n<p>내가 신경 쓸 수 있을 때까지는 최대한 운영해보려고 한다.</p>\n<h2 id=\"-분석-배운-점\" style=\"position:relative;\"><a href=\"#-%EB%B6%84%EC%84%9D-%EB%B0%B0%EC%9A%B4-%EC%A0%90\" aria-label=\" 분석 배운 점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>💡 분석, 배운 점</h2>\n<p>24시간 돌아가는 서버를 운영해 보니 예상치 못한 오류나 상황으로 인해 불상사가 생기는 것을 경험할 수 있었고, 이후에 발생할 수 있는 모든 상황에 대한 예외처리나 오류를 미리 신경 써서 대비하는 등 안정성에도 집중하여 만들게 되었다.</p>\n<blockquote>\n<p>실제로 예외처리를 놓친 부분에서 cgv 서버에서 http 응답이 200이 아닌 429 Too Many Requests가 뜨게 되자, 서버가 종료가 되어버렸고, 결국 집에 돌아와서 재실행하기 전에 예매가 오픈되어 버려 알림이 무용지물이 되어버린 사고가 일어났었다.</p>\n</blockquote>\n<p>또 라즈베리파이에서 서버를 그냥 운영하니 CI/CD 측면에서 불편한 점이 너무 많아 Docker를 사용해보았는데 너무너무 편리하였다. 앞으로도 운영과 배포에도 더 신경을 써야겠다.</p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#-%EA%B0%9C%EC%9A%94\">📚 개요</a></p>\n</li>\n<li>\n<p><a href=\"#-%EC%A0%9C%EC%9E%91-%EB%8F%99%EA%B8%B0\">🏁 제작 동기</a></p>\n</li>\n<li>\n<p><a href=\"#-%EC%98%81%ED%99%94-%EC%98%88%EB%A7%A4-%EC%A0%95%EB%B3%B4-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0\">📑 영화 예매 정보 가져오기</a></p>\n<ul>\n<li><a href=\"#%EC%82%AC%EC%9D%B4%ED%8A%B8-%EB%B6%84%EC%84%9D\">사이트 분석</a></li>\n<li><a href=\"#%EA%B0%80%EC%A0%B8%EC%98%A8-%EC%98%81%ED%99%94-%EC%98%88%EB%A7%A4-%EC%A0%95%EB%B3%B4-%EB%B6%84%EC%84%9D\">가져온 영화 예매 정보 분석</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EF%B8%8F-%EC%98%88%EB%A7%A4-%EC%98%A4%ED%94%88%EC%9D%84-%ED%99%95%EC%9D%B8%ED%95%A0-%EB%A9%94%EC%9D%B8-%EB%A1%9C%EC%A7%81\">♾️ 예매 오픈을 확인할 메인 로직</a></p>\n<ul>\n<li><a href=\"#%EA%B8%B0%EC%A4%80-%EA%B0%92-%EC%B4%88%EA%B8%B0%ED%99%94%ED%95%98%EA%B8%B0\">기준 값 초기화하기</a></li>\n<li><a href=\"#%EB%B3%80%EA%B2%BD%EC%82%AC%ED%95%AD-%EC%B0%BE%EA%B8%B0\">변경사항 찾기</a></li>\n<li><a href=\"#%EC%98%88%EB%A7%A4-%EC%98%A4%ED%94%88-%ED%91%B8%EC%8B%9C-%EC%95%8C%EB%A6%BC-%EC%A0%84%EC%86%A1%ED%95%98%EA%B8%B0\">예매 오픈 푸시 알림 전송하기</a></li>\n<li><a href=\"#%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8-%ED%8A%B9%EB%B3%84%EA%B4%80-%EC%98%88%EB%A7%A4-%EC%98%A4%ED%94%88%EC%9D%84-%ED%99%95%EC%9D%B8%ED%95%98%EC%9E%90\">(업데이트) 특별관 예매 오픈을 확인하자!</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%EB%A9%94%EC%9D%B8-%EB%A1%9C%EC%A7%81%EC%9D%84-247-%EC%8B%A4%ED%96%89%ED%95%98%EA%B8%B0\">🏪 메인 로직을 24/7 실행하기</a></p>\n<ul>\n<li><a href=\"#%EC%97%AC%EB%9F%AC-%EC%98%81%ED%99%94%EB%93%A4%EC%97%90-%EB%8C%80%ED%95%B4%EC%84%9C-%ED%99%95%EC%9D%B8%ED%95%98%EA%B8%B0\">여러 영화들에 대해서 확인하기</a></li>\n<li><a href=\"#%EC%98%88%EC%99%B8-%EB%B0%9C%EC%83%9D-%EC%8B%9C-%EC%98%88%EC%99%B8-%EC%B2%98%EB%A6%AC\">예외 발생 시 예외 처리</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%EC%95%8C%EB%A6%BC-%EB%B3%B4%EB%82%B4%EA%B8%B0\">🔔 알림 보내기</a></p>\n<ul>\n<li><a href=\"#ntfy\">ntfy</a></li>\n<li><a href=\"#%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8-docker%EB%A1%9C-%EC%9A%B4%EC%98%81%ED%95%98%EA%B8%B0\">(업데이트) Docker로 운영하기</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%EC%84%9C%EB%B2%84-%EC%83%81%ED%83%9C-%ED%99%95%EC%9D%B8-%ED%8E%98%EC%9D%B4%EC%A7%80\">🔋 서버 상태 확인 페이지</a></p>\n<ul>\n<li><a href=\"#%EA%B2%B0%EA%B3%BC\">결과</a></li>\n<li><a href=\"#%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8-%EC%84%9C%EB%B2%84-%EC%9D%B4%EC%A0%84-%EC%9D%B4%ED%9B%84\">(업데이트) 서버 이전 이후…</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EF%B8%8F-%EC%84%9C%EB%B2%84-%EC%9A%B4%EC%98%81-%EB%B0%8F-%EC%84%B1%EA%B3%BC\">🖥️ 서버 운영 및 성과</a></p>\n<ul>\n<li><a href=\"#%EC%9E%90%EB%8F%99-%EC%8B%A4%ED%96%89-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\">자동 실행 설정하기</a></li>\n<li><a href=\"#%EB%B3%B4%EC%95%88-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\">보안 설정하기</a></li>\n<li><a href=\"#%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8-docker-%ED%99%9C%EC%9A%A9%ED%95%98%EA%B8%B0\">(업데이트) Docker 활용하기</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%EC%98%88%EB%A7%A4-%EC%98%A4%ED%94%88-%EC%95%8C%EB%A6%BC%EC%9D%84-%EB%B0%9B%EC%95%98%EB%8B%A4\">⏰ 예매 오픈 알림을 받았다!</a></p>\n</li>\n<li>\n<p><a href=\"#-%EB%A7%88%EB%AC%B4%EB%A6%AC\">🔖 마무리</a></p>\n</li>\n<li>\n<p><a href=\"#-%EB%B6%84%EC%84%9D-%EB%B0%B0%EC%9A%B4-%EC%A0%90\">💡 분석, 배운 점</a></p>\n</li>\n</ul>\n</div>","excerpt":"See this project on Github 👉 Link 📚 개요 CGV 예매 오픈 알리미 제작 기간 : 2024/3/2 ~ 2024/3/11 ~ 유지보수 중 라즈베리파이로 운영한 기간 : 2024/3/2 ~ 2024/6/3 Docker Container로 운영한 기간 : 2024/6/3 ~ 운영 중 🏁 제작 동기 우리나라 단연 최고의 영화관이라고 할 수 있는 CGV 용산아이파크몰 IMAX관. 그러나 1.43:1 비율의 IMAX GT 비율의 영화가 개봉한다고 하면 새벽과 심야 시간 때까지 매진 행렬이 이어진다. 나도 좀 편하게 명당자리에서 보고 싶어서 예매가 오픈되었을 때 알림을 보내주는 프로그램을 만들기로 하였다. 📑 영화 예매 정보 가져오기 처음에는 Selenium이나 Beautiful Soup 같은 것으로 크롤링, 스크래핑을 하려고 했지만 몇 번 시도해 보다가 변수가 너무 많았고, 구현하고자 하는 목적에 맞는 방법이 아니라고 생각이 들어 개발자 도구로 CGV 홈페이지를 뜯…","frontmatter":{"date":"March 02, 2024","title":"CGV 예매 오픈 알리미","categories":"기록","author":"0w0i0n0g0","emoji":"🔔"},"fields":{"slug":"/records-cgv-open-push/"}},"next":{"id":"ae582ee4-1e7b-5696-8692-725a1824d2d1","html":"<p>See this project on Github 👉 <a href=\"https://github.com/0w0i0n0g0/usage-widget-for-smartel\" target=\"_blank\">Link</a></p>\n<h2 id=\"-개요\" style=\"position:relative;\"><a href=\"#-%EA%B0%9C%EC%9A%94\" aria-label=\" 개요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📚 개요</h2>\n<ul>\n<li>\n<p>아이폰용 알뜰폰 사용량 위젯</p>\n</li>\n<li>\n<p>제작 기간 : 2021/8/6 ~ 2021/8/9</p>\n</li>\n<li>\n<p>v.2 업데이트 : 2022/4/8 ~ 2022/4/17</p>\n</li>\n</ul>\n<h2 id=\"-동기\" style=\"position:relative;\"><a href=\"#-%EB%8F%99%EA%B8%B0\" aria-label=\" 동기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🏁 동기</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 172px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 99.4186046511628%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD5klEQVQ4y+3S+W+TBQDG8ed9p/GIGFEUkcxNXO+ue3v37cmuXjva7lZkcTqNKCRM52BhE7IyAefiGJKpm24w5YguJC4aCYtG8SYhiJM4cQ5Hy9qt79W3dIuG1BB/NJmJxt/8/gGfPD88wH/ZLxPjmHzvKM6OHkLk61PICBdxjZ1CevbcPwMvff8NYr07MNe/G9EjbyAyHCaE/i3Eb92bkW6rwdkjPZh8uQGXuzZgaWnp78HZ819hrq8T0YNhRI4PIvrWbgiDXciMfYvMMz5ca3OTv472Y767BWznY7j43afLgzNfTIDv2gTmlXZETxzOiR7ely8MhddkPkyTmWIg01GLM2c+weToAUwfeAGXMpnlwdjkl5gZ2ovz4x9g+uT7a2L7N4eTu6oHkjsCPeL2DVv57kfsP06M3/rzyCCiL7VgJjGzPBg59znmDm4Ht6eaiA9vA7eTXnG1vSTMbvN8zLV5T6VbywfE7mfVmcZyZJrdxA/vvvZX5KfQk5hpasXlQBNmj72DK693gN0bALO/meDDXvBVNyLZ5nlCeK74QvJ5z1g6XCvJvLgSi2Ul5CLpAictQWK1BoyilGAkToBda0ZM5yeEBwxZDOUjWImT5HPVWeK9JjJZbL3hwvpVBLvTDr41VMi2+Qf4zoAx+WgF0gVdEA0BUsjVkvE8A7kgL8WCzAkwdxuvg+AfNIGh/OAk68HlqpHKMUHMzsdUTRN+v9kKoawY8QYHBEchlmq6V6RdLXemdCEI91OIqC2Yt9YVRW2BVYhLCjFnCVIJbUnjgiWk4vSV7pjCvJGRO6sW8u010canbkupigK8ye0UXAFjnHIG2DzbCU5qH+FCzasZZWlHhPZSnMw6zOUYjIjdlIuEuqiPldIfCbS/i5VZj7NSwxAvow9x67RvctqiTSlNYS8rt57kpZbP5hWOPbzM2McpTWFeYn+V0xSOcyrXiCih3xbvUecjvXIduAL3xoTKNsLK6dOsmt7FKm3Ngsa1lZGatog59FiConvm1Y5jqTz76SRVki0ozcGk1NbLSZztgtRxVCwIPC7K6NHkWkoLNs+EecqnYhR03RVTuXbR8LBasAVkKbpWkTIGZEK+3xBX2kKsodzFmOpsaXPDXVPG4O2iqswtNDx9Cyv1uuf0wftYR72a11fcAT5bA1ZVDEZBI671Ia2rgUBXQDRXIaUrgyh3I6a0gqW8YPQhpOh6TBdUQpR7kax8CKykCHHKD56uAl/gwZ8LtT6CUViyYgYveVVfTQiWckK0BAnx+p2UHjKutJGMzkdyuiCZNtdjVu+BqPKRnLUSnMxDLuiCBGcOErzGg//79/0BysC37epj+A0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"smartel.png\"\n        title=\"smartel.png\"\n        src=\"/static/07b0ceb9503f17e10b2180644c7bd8e7/44eb2/smartel.png\"\n        srcset=\"/static/07b0ceb9503f17e10b2180644c7bd8e7/44eb2/smartel.png 172w\"\n        sizes=\"(max-width: 172px) 100vw, 172px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p>내가 사용했던 ‘스마텔’이라는 알뜰폰 업체</p>\n</blockquote>\n<p>새 폰으로 바꾸면서 자급제 + 알뜰폰 조합을 사용해 보았는데, 저렴하지만 부실한 고객대응과 통신 3사에서는 너무나 당연한 사용량 위젯 같은 편의기능도 없는 등 불편한 부분이 많았다.</p>\n<p>그래서 내가 직접 위젯을 만들고, 배포도 하기로 하였다.</p>\n<h2 id=\"-어떻게-만들까\" style=\"position:relative;\"><a href=\"#-%EC%96%B4%EB%96%BB%EA%B2%8C-%EB%A7%8C%EB%93%A4%EA%B9%8C\" aria-label=\" 어떻게 만들까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🤔 어떻게 만들까?</h2>\n<p>안드로이드는 스마텔 고객센터 앱이 있는데, 나는 아이폰을 사용하고 있고, 앱스토어에 스마텔 고객센터 앱 자체가 없었다…</p>\n<p>그래서 찾아보니 “마이스마텔”이라는 웹사이트를 고객센터 앱 대신 운영 중이였다.</p>\n<p>이 웹사이트를 이용해서 만들 것이다.</p>\n<h2 id=\"-위젯-만들기\" style=\"position:relative;\"><a href=\"#-%EC%9C%84%EC%A0%AF-%EB%A7%8C%EB%93%A4%EA%B8%B0\" aria-label=\" 위젯 만들기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📣 위젯 만들기⁉</h2>\n<p>아이폰에 위젯을 만들려면</p>\n<ol>\n<li>\n<p>앱스토어에 앱을 배포하여 그 앱에서 위젯을 추가한다.</p>\n</li>\n<li>\n<p>위젯을 추가해 주는 서드파티 앱을 활용한다.</p>\n</li>\n</ol>\n<p>위 두 가지 방법이 있다.</p>\n<p>아직 iOS 개발도 안 해봤고, 애플 개발자로 등록하려면 돈도 내야 하기 때문에 💸 바로 2번을 선택했다.</p>\n<p>위젯을 추가해 주는 서드파티 앱 중에서 코드로 작동이 되고, 유명한 앱이 있다.</p>\n<p>바로 scriptable이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 225px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAA7zAAAO8wEcU5k6AAACtklEQVQ4y53LS08TURgG4BMuIS1tp3M53zlz5kw7nd4YsC2lyK0BjRgMIcFQjUlREIkbSBAqBGEFIrdEpAgSlIWYQFgikBgTlqx0r7/A+D8MjFSEHcmzeb/vfRE1m68MkUD6yhAYjRcQs0kNpkngLAZOo9l0uYkgUH+BC2IlQtirJYnZQMwGr5YsEcIuErvcROBP/cdXk3mYm13aTrdmRRYXWTzdmp1b2sl057Cv5kIZgS9po0bKpUQy3bnj778HcwuJ+g5Zi8taPFHfMfh84fjbr0x2pFyJUCNVmCDiq7apRo1DNCemPiyvH6AiCetx6k8SI6nocVQkLa/vTUy9d4imaqTAX21DoCdsLFDrkkPDE2uLq5/LpSALpM7uqXIpuLi692zyrUsJskBtYYIwj9lEGkXF4uTMp4W1/TK3rvqr4fRO/dVlHn1x9WDi1UdULIqkAvQY8BMI8yrMr8nMqmu529U98mbja1vnU0ExiS8GJ68q8MU8inmns39540tXdqSuOaMwC3gV8CqENQt4pUhCD3rG8ptH8+8OzcpGiYYxr8SaZX9lGg5ajQtrh/nNo/uPxr0khHmlolkIWARYhLCoV/IVlXpm8vtjU1tOF1DdAhYFFqXccrpgdGrrZf6guFQQJJ1oUXuFiBqyMd1yeUnvwPyL2V23hzJe8ffOK9wCHZ/b7R2Yd3uJpluFCQLVtFEtXO6R+4aWRqe3ESpWiEFYkLAgpgZCJbnpnb6h1063TLVQYYIINWyUmYIXbrT3rOz+uPd40oo1YaxjzK1YOtM3ubL782Z7r+BVVGYWJgiIXoCJrgBvbuvuH84nam9LMpVkmrh+68nwUktbFoOGCT/fR5hoBQAaEE0QRKfDIUoYKAfKRQmcDqcgiHBaON9HGOhFRAWqYaKei+xfPAcpmFwZUhS4sj8q98pqmK1X9gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"scriptable.png\"\n        title=\"scriptable.png\"\n        src=\"/static/57481c9219b3c9a4dfded3253c3b99fb/3684f/scriptable.png\"\n        srcset=\"/static/57481c9219b3c9a4dfded3253c3b99fb/e9ff0/scriptable.png 180w,\n/static/57481c9219b3c9a4dfded3253c3b99fb/3684f/scriptable.png 225w\"\n        sizes=\"(max-width: 225px) 100vw, 225px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>scriptable은 iOS 상에서 자바스크립트를 구동하여 자동화, 위젯 등 커스텀을 할 수 있도록 해준다.</p>\n<p>이 앱을 활용해 위젯을 만들어보자.</p>\n<h2 id=\"-로그인하기\" style=\"position:relative;\"><a href=\"#-%EB%A1%9C%EA%B7%B8%EC%9D%B8%ED%95%98%EA%B8%B0\" aria-label=\" 로그인하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📧 로그인하기</h2>\n<p>사용량을 받아오기 위해서 먼저 로그인을 해야 한다.</p>\n<p>개발자 도구를 활용해 로그인 시에 어떤 통신이 일어났는지 살펴보았다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.22222222222221%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACO0lEQVQ4y4WT647TMBCF89igRUJCIH7wj+dYFtAi3gMkBGhZ2qZxbMeX2M61adKDZrqtKrSIkaxxHPvTmTN2VkoFYx1CTOj6ATElqMrh+68thNQoCoF8W6AQJefToG/rHKzzPCpj4bxHJoTAarWGcw7zPKPvezRNg7KU0ErDGANdVfDeYxxHDMPAebfb4XA4gOMhT9OErKoMNpsNUkpYloWBNJx1sMairmt0Xcf/HguCHi6BeXkspSxLSClZKQGVUjCVYQtIzW6aOA/DyPBL0Cn2+z2yohQwQoBKJ7+stQykTHBj7HHuPaumtRgThn5A3w8IMSKlBk1qeD2rrUVVFOi7DvOysEdt26L2Hm3TIsbIoNrX7CP5e1Q6cImXSlkhGU6dps20gQ4QRGuNSlfclLoOCCHyHmsdYoislNbJ33HcMZCalVkpIZVi88kb9TDn7irN6vbzjH/FpUI6lzlSWEoGnIDU8RCOqmgTeXp5+HKc1s9AJQQ2ec6lMFBreF9Dc7kWqWnOJZ2u3N/QZbkAClHyPSR/6CcBU/AwWsFoCVtpeGsQg0eTAoauwW7sMfYt+jZhGgeez9MIU+njS1mvN3wtgAO2QuLNrcbrTzWev/d4detxde3w8qPFiw8OT69rXN1EXN2Ec352E/DkXcLbz+KoMM+33C16elIq/Fhb3ImEleqwtSNkWCDjAhUXiHp+ZOxRhgPuC4fs7n6FL1+/4efdPX6vcuSFwNg18FZDihyVKtE1kdX/L9om4g8JeCXY7B6tOAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"login.png\"\n        title=\"login.png\"\n        src=\"/static/9c89ece39f513c120696cf1ffe86d6f3/37523/login.png\"\n        srcset=\"/static/9c89ece39f513c120696cf1ffe86d6f3/e9ff0/login.png 180w,\n/static/9c89ece39f513c120696cf1ffe86d6f3/f21e7/login.png 360w,\n/static/9c89ece39f513c120696cf1ffe86d6f3/37523/login.png 720w,\n/static/9c89ece39f513c120696cf1ffe86d6f3/d2a60/login.png 807w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><code class=\"language-text\">m_login_proc.asp</code>로 POST 형식으로 로그인 정보가 전달되었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">//login to smartel</span>\n<span class=\"token keyword\">let</span> reqlogin <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Request</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://www.smartelmobile.com:5009/mobile2/m_login_proc.asp'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nreqlogin<span class=\"token punctuation\">.</span>method <span class=\"token operator\">=</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">;</span>\n\nreqlogin<span class=\"token punctuation\">.</span>headers <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'application/x-www-form-urlencoded'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">Origin</span><span class=\"token operator\">:</span> <span class=\"token string\">'https://www.smartelmobile.com:5009'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nreqlogin<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> <span class=\"token string\">'goUrl=&amp;hp_no=01012345678&amp;user_nm=%B0%A1%B3%AA%B4%D9&amp;pwd=Abcdefg1234%40'</span><span class=\"token punctuation\">;</span>\n\nreqlogin<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onRedirect</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">request</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> reslogin <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> reqlogin<span class=\"token punctuation\">.</span><span class=\"token function\">loadString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">reslogin</code>을 로그로 찍어보면 로그인에 성공되었는지 안 되었는지 알 수 있었다.</p>\n<p>성공했다면 실명이 찍혀서 나오고, 실패하였다면 빈칸으로 나온다.</p>\n<h3 id=\"한글-인코딩-문제에-부딪히다\" style=\"position:relative;\"><a href=\"#%ED%95%9C%EA%B8%80-%EC%9D%B8%EC%BD%94%EB%94%A9-%EB%AC%B8%EC%A0%9C%EC%97%90-%EB%B6%80%EB%94%AA%ED%9E%88%EB%8B%A4\" aria-label=\"한글 인코딩 문제에 부딪히다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>한글 인코딩 문제에 부딪히다.</h3>\n<p>단순히 한글을 URI 인코딩을 통해 정보를 보내면 될 것이라고 생각했지만 아무리 시도해 보아도 로그인이 되지 않았다.</p>\n<p>자세히 보니 <code class=\"language-text\">encodeURIComponent</code> 함수로 인코딩한 것과 실제 로그인할 때 보내지는 것이 달랐다.</p>\n<h3 id=\"문제-원인\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C-%EC%9B%90%EC%9D%B8\" aria-label=\"문제 원인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제 원인</h3>\n<p>문제는 “한글” 이름에 있다는 것을 알게 되었다.</p>\n<p>모든 인코딩 사이트에서 기본적으로 한글을 URI인코딩하면, 한글이 UTF-8로 지정되고 인코딩 되었다.</p>\n<p>그런데 로그인 페이지는 EUC-KR이라는 한글 인코딩을 사용하고 있었던 것이다. 😂</p>\n<h3 id=\"임시방편으로-문제-해결\" style=\"position:relative;\"><a href=\"#%EC%9E%84%EC%8B%9C%EB%B0%A9%ED%8E%B8%EC%9C%BC%EB%A1%9C-%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0\" aria-label=\"임시방편으로 문제 해결 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>임시방편으로 문제 해결…</h3>\n<p>원인을 알아도 난감했다.</p>\n<p>자바스크립트에는 자체적으로 EUC-KR을 URI인코딩하는 함수가 아무리 찾아도 없었고, scriptable 앱 자체에서 구동되어야 하기 때문에 외부 라이브러리를 쓰기도 난감했다.</p>\n<p>그래서 임시방편으로 어쩔 수 없이 EUC-KR URI 인코딩을 지원하는 api에 일일이 한글 텍스트를 보내서 인코딩 된 정보를 받는 방법을 사용했다.</p>\n<h3 id=\"완전-문제-해결-v2\" style=\"position:relative;\"><a href=\"#%EC%99%84%EC%A0%84-%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0-v2\" aria-label=\"완전 문제 해결 v2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>완전 문제 해결! (v.2)</h3>\n<p>인터넷에서 EUC-KR과 UTF-8을 모두 매핑해서 URI EUC-KR을 UTF-8로 디코딩하는 자바스크립트 파일을 찾아냈다.</p>\n<p><a href=\"https://blog.naver.com/csaiur/10044269972\">URL 인코딩 된 EUC-KR 문자열의 디코딩</a></p>\n<p>내가 원하는 것과 정반대의 기능이었지만, 매핑된 것을 반대로 역함수를 만들어서 UTF-8을 URI EUC-KR로 인코딩하는 기능을 추가했다.</p>\n<p>이것을 위젯 소스코드 자체에 삽입해서 외부로 api 호출 없이 자체적으로 한글 인코딩을 할 수 있도록 해결했다.</p>\n<h2 id=\"-사용량-가져오기\" style=\"position:relative;\"><a href=\"#-%EC%82%AC%EC%9A%A9%EB%9F%89-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0\" aria-label=\" 사용량 가져오기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📂 사용량 가져오기</h2>\n<h3 id=\"사용량-받기\" style=\"position:relative;\"><a href=\"#%EC%82%AC%EC%9A%A9%EB%9F%89-%EB%B0%9B%EA%B8%B0\" aria-label=\"사용량 받기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>사용량 받기</h3>\n<p>이제 로그인에 성공하였으니 사용량을 받아와야 한다.</p>\n<p>사용량은 <code class=\"language-text\">m_realTimePay_info_lg.asp</code>에서 조회할 수 있었다.</p>\n<h3 id=\"사용량-페이지-불러오기\" style=\"position:relative;\"><a href=\"#%EC%82%AC%EC%9A%A9%EB%9F%89-%ED%8E%98%EC%9D%B4%EC%A7%80-%EB%B6%88%EB%9F%AC%EC%98%A4%EA%B8%B0\" aria-label=\"사용량 페이지 불러오기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>사용량 페이지 불러오기</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">//load usage</span>\n<span class=\"token keyword\">let</span> req <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Request</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://www.smartelmobile.com:5009/mobile2/m_realTimePay_info_lg.asp'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> req<span class=\"token punctuation\">.</span><span class=\"token function\">loadString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">res</code>에 사용량 정보를 string으로 불러온다.</p>\n<h3 id=\"사용량-추출하기\" style=\"position:relative;\"><a href=\"#%EC%82%AC%EC%9A%A9%EB%9F%89-%EC%B6%94%EC%B6%9C%ED%95%98%EA%B8%B0\" aria-label=\"사용량 추출하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>사용량 추출하기</h3>\n<p>이렇게 <code class=\"language-text\">res</code>에 string으로 요청하면 html이 string으로 저장된다.</p>\n<p>그리고 이렇게 받아온 문자열을 가공해서 사용량 정보를 추출하면 된다.</p>\n<p>사용량 정보는 <code class=\"language-text\">res</code>에 저장된 html에 table 태그로 감싸 담겨 있었다.</p>\n<p>table 태그를 기준으로 문자열을 자르고, 내부에 필요 없는 html 태그를 삭제하고, 줄 바꿈 문자를 기준으로 문자열을 나눠서 배열로 저장한다.</p>\n<p>사용량 정보가 table에 규칙적으로 저장되어 있기 때문에, 이렇게 하면 특정 주기로 문자, 음성, 데이터에 대한 정보가 일정하게 반복되어 구분할 수 있게된다.</p>\n<p>undefined를 trim 하면 에러가 나기 때문에 건너뛰고, 반복하여 trim 한다.</p>\n<h3 id=\"결과\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EA%B3%BC\" aria-label=\"결과 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결과</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">사용량 배열\n[SMT] USIM 스마트 심플(100분 + 1.5GB),문자,건,100,3,기본요금제,,[SMT] USIM 스마트 심플(100분 + 1.5GB),음성+영상,초,6000,358,기본요금제,,[SMT] USIM 스마트 심플(100분 + 1.5GB)(요금제종속),패킷데이터,KB,1536000,161152,요금제종속상품,,,</code></pre></div>\n<p>사용량이 말끔하게 정리되어 나온 것을 알 수 있다.</p>\n<h2 id=\"-받아온-사용량-해석하기\" style=\"position:relative;\"><a href=\"#-%EB%B0%9B%EC%95%84%EC%98%A8-%EC%82%AC%EC%9A%A9%EB%9F%89-%ED%95%B4%EC%84%9D%ED%95%98%EA%B8%B0\" aria-label=\" 받아온 사용량 해석하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📏 받아온 사용량 해석하기</h2>\n<h3 id=\"배열-분석하기\" style=\"position:relative;\"><a href=\"#%EB%B0%B0%EC%97%B4-%EB%B6%84%EC%84%9D%ED%95%98%EA%B8%B0\" aria-label=\"배열 분석하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>배열 분석하기</h3>\n<p>앞에서 가져온 사용량을 <code class=\"language-text\">usage_array</code>라는 배열에 저장하였다.</p>\n<p>이 배열은 table 태그에서 추출했기 때문에 규칙성이 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">요금제 내용 / 종류 / 단위 / 제공량 / 사용량 / 비고 / 빈칸</code></pre></div>\n<p>이 순서대로 반복된 배열이다.</p>\n<p>이 배열을 규칙대로 해석해서 쓸모 있는 데이터로 바꾸어보자.</p>\n<h3 id=\"결과-1\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EA%B3%BC-1\" aria-label=\"결과 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결과</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">문자/1/문자/100\n음성+영상/8/음성+영상/6000\n패킷데이터/15/패킷데이터1536000</code></pre></div>\n<h2 id=\"-추가적인-기능-구현하기\" style=\"position:relative;\"><a href=\"#-%EC%B6%94%EA%B0%80%EC%A0%81%EC%9D%B8-%EA%B8%B0%EB%8A%A5-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0\" aria-label=\" 추가적인 기능 구현하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🦖 추가적인 기능 구현하기</h2>\n<h3 id=\"새로고침되는-시간-표시\" style=\"position:relative;\"><a href=\"#%EC%83%88%EB%A1%9C%EA%B3%A0%EC%B9%A8%EB%90%98%EB%8A%94-%EC%8B%9C%EA%B0%84-%ED%91%9C%EC%8B%9C\" aria-label=\"새로고침되는 시간 표시 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>새로고침되는 시간 표시</h3>\n<p>아무래도 실시간 사용량 위젯이다 보니, 위젯이 새로고침되는 것이 매우 중요하다.</p>\n<p>scriptalbe에서 제공하는 리프레시 함수를 설정해 주었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">widget<span class=\"token punctuation\">.</span>refreshAfterDate <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1000</span> <span class=\"token operator\">*</span> <span class=\"token number\">120</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>다만 이렇게 설정해도 scriptalbe을 비롯한 모든 위젯 지원 앱들이 애플이 정한 위젯 정책 때문에 설정한 시간에 바로 새로고침되지 않는 이슈가 있다.</p>\n<p>이 불편함을 조금이라도 해결하기 위해 위젯에 최근에 새로고침된 시간을 표시하기로 하였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">//show when widget is refreshed</span>\n<span class=\"token keyword\">var</span> now <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> hours <span class=\"token operator\">=</span> now<span class=\"token punctuation\">.</span><span class=\"token function\">getHours</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> minutes <span class=\"token operator\">=</span> now<span class=\"token punctuation\">.</span><span class=\"token function\">getMinutes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이제 위젯이 최근에 새로고침된 시간을 표시할 수 있다.</p>\n<h3 id=\"수동-새로고침-기능\" style=\"position:relative;\"><a href=\"#%EC%88%98%EB%8F%99-%EC%83%88%EB%A1%9C%EA%B3%A0%EC%B9%A8-%EA%B8%B0%EB%8A%A5\" aria-label=\"수동 새로고침 기능 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>수동 새로고침 기능</h3>\n<p>scriptable은 위젯을 눌렀을 때 실행할 기능을 설정할 수 있다.</p>\n<p>위젯을 만들 때 When Interacting을 Run Script로 설정하면 위젯을 터치하면 수동으로 새로고침을 할 수 있다.</p>\n<h3 id=\"단축어로-위젯-설치-v2\" style=\"position:relative;\"><a href=\"#%EB%8B%A8%EC%B6%95%EC%96%B4%EB%A1%9C-%EC%9C%84%EC%A0%AF-%EC%84%A4%EC%B9%98-v2\" aria-label=\"단축어로 위젯 설치 v2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>단축어로 위젯 설치 (v.2)</h3>\n<p>기존에는 직접 코드를 복붙하거나, 설치 함수를 복붙해서 실행하는 방식으로 설치를 안내했는데, 누가 봐도 불편하고, 잘못하는 분들도 많을 것 같아 단축어만으로 위젯을 설치할 수 있도록 기능을 추가했다.</p>\n<p>iOS 단축어 기능 중 ‘url로 콘텐츠 가져오기’를 활용하여 텍스트 파일을 불러와 scriptable에 저장시키는 방식으로 다운로드를 구현했다.</p>\n<p><a href=\"https://github.com/0w0i0n0g0/usage-widget-for-smartel#%EC%84%A4%EC%B9%98\">설치 과정 보러가기</a></p>\n<h3 id=\"키체인-활용하기-v2\" style=\"position:relative;\"><a href=\"#%ED%82%A4%EC%B2%B4%EC%9D%B8-%ED%99%9C%EC%9A%A9%ED%95%98%EA%B8%B0-v2\" aria-label=\"키체인 활용하기 v2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>키체인 활용하기 (v.2)</h3>\n<p>기존에는 직접 코드에 사용자가 로그인 정보를 입력해야 했고, 이 파일이 유출된다면 그대로 개인정보가 보이는 문제가 있었다.</p>\n<p>그래서 단축어로 설치하는 기능을 추가하면서 scriptable에서 제공하는 키체인 기능을 활용하여 보안도 강화하고, 로그인 정보도 단축어로 설정할 수 있도록 구현했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> <span class=\"token constant\">NAME</span> <span class=\"token operator\">=</span> <span class=\"token string\">'user_nm'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> <span class=\"token constant\">PHONE</span> <span class=\"token operator\">=</span> <span class=\"token string\">'hp_no'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> <span class=\"token constant\">PASSWORD</span> <span class=\"token operator\">=</span> <span class=\"token string\">'pwd'</span><span class=\"token punctuation\">;</span>\n\nKeychain<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token constant\">NAME</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">.</span>plainTexts<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\s</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">gi</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nKeychain<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PHONE</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">.</span>plainTexts<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\s</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">gi</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nKeychain<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PASSWORD</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">.</span>plainTexts<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\s</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">gi</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Keychain<span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span><span class=\"token constant\">NAME</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> Keychain<span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PHONE</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> Keychain<span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PASSWORD</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token string\">'성공!'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token string\">'실패. 다시 시도해주세요.'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"-위젯-디자인하기\" style=\"position:relative;\"><a href=\"#-%EC%9C%84%EC%A0%AF-%EB%94%94%EC%9E%90%EC%9D%B8%ED%95%98%EA%B8%B0\" aria-label=\" 위젯 디자인하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>👀 위젯 디자인하기</h2>\n<h3 id=\"위젯-종류\" style=\"position:relative;\"><a href=\"#%EC%9C%84%EC%A0%AF-%EC%A2%85%EB%A5%98\" aria-label=\"위젯 종류 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>위젯 종류</h3>\n<p>scriptable에서 제공하는 위젯 크기는 2x2, 2x4, 4x4 사이즈, 총 3종류가 있다.</p>\n<p>사용자가 어떤 크기를 원할지 모르고, 특정 요금제는 표시되는 정보가 크니 모든 사이즈에 호환되게 디자인했다.</p>\n<h3 id=\"만들기\" style=\"position:relative;\"><a href=\"#%EB%A7%8C%EB%93%A4%EA%B8%B0\" aria-label=\"만들기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>만들기</h3>\n<p>다만 고려해야 하는 점은, 무제한 요금제일 땐 음성과 음성+영상이 따로 표시된다.</p>\n<p>무제한 요금제는 보통 음성을 무제한으로 주고, 음성+영상이라는 부가통화에 제한이 걸려있다.</p>\n<p>이를 고려해 음성을 표시하는 call에 따라, 위젯의 크기에 따라, 총 6개의 경수의 수마다 중 알맞은 디자인 프로파일을 설정하여 자동으로 적용되도록 만들었다.</p>\n<h3 id=\"결과-2\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EA%B3%BC-2\" aria-label=\"결과 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결과</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 300px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 192.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"feature1.png\"\n        title=\"feature1.png\"\n        src=\"/static/b31ef5d370d47fc8293eb47c2243e94e/5a46d/feature1.png\"\n        srcset=\"/static/b31ef5d370d47fc8293eb47c2243e94e/e9ff0/feature1.png 180w,\n/static/b31ef5d370d47fc8293eb47c2243e94e/5a46d/feature1.png 300w\"\n        sizes=\"(max-width: 300px) 100vw, 300px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 193.33333333333331%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"feature2.png\"\n        title=\"feature2.png\"\n        src=\"/static/212a13261e70d949941e9560356b1736/37523/feature2.png\"\n        srcset=\"/static/212a13261e70d949941e9560356b1736/e9ff0/feature2.png 180w,\n/static/212a13261e70d949941e9560356b1736/f21e7/feature2.png 360w,\n/static/212a13261e70d949941e9560356b1736/37523/feature2.png 720w,\n/static/212a13261e70d949941e9560356b1736/2e694/feature2.png 1048w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"-마무리\" style=\"position:relative;\"><a href=\"#-%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\" 마무리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🔖 마무리</h2>\n<p>처음부터 끝까지 내가 직접 만들어서 배포하는 프로그램이기 때문에 정말 뜻깊었다.</p>\n<p>모두가 사용할 수 있도록 배포하는 만큼 다른 사람들도 사용할 수 있도록 README도 최대한 자세하게 적으려고 노력했다.</p>\n<p>그리고 여러 회선으로 직접 테스트하면서 정상작동하는지 확인하였다.</p>\n<p>다 만들고 배포할 때, 저렴하게 핸드폰을 바꾸는데 도움을 준 커뮤니티들에 링크를 올렸고, 많은 관심을 주셔서 감사했다.</p>\n<p>부족한 점도 있지만, 사용해 주는 많은 사람들과 도움이 되었다는 댓글들을 보면서 뿌듯함을 느꼈다. 🥰</p>\n<h2 id=\"-분석-배운-점\" style=\"position:relative;\"><a href=\"#-%EB%B6%84%EC%84%9D-%EB%B0%B0%EC%9A%B4-%EC%A0%90\" aria-label=\" 분석 배운 점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>💡 분석, 배운 점</h2>\n<p>사실 중간에 인코딩 문제 때문에 조금 막힌 것 말고는 생각나는 대로 만들어서 다 만들고 보니 이상한 부분들이 많았다.</p>\n<p>아무 계획 없이 웹사이트 정보 -> 위젯을 만드려고 단순하게만 생각하고 있었고, 계획 없이 부딪히다 보니 퀄리티에 많이 신경을 쓰지 못했던 것이 아쉬웠다.</p>\n<p>특히 받아온 사용량을 해석하는 부분의 로직이 마음에 들지 않았지만, 구현하는 데에 급해서 반복문 복붙으로 만들어 버렸다…</p>\n<p>그래도 혹시라도 발생할 수 있는 오류에 대비해 사용해 주시는 분들이 로그만 올리면 고칠 수 있도록 로그를 보기 쉽고, 필요한 정보를 모두 넣은 것을 잘했다고 생각한다.</p>\n<p>만들 때도 테스트할 때 로그를 통해 어디에서 멈추거나, 어디에서 잘못되었는지 쉽게 찾아내서 고칠 수 있어 편리했다.</p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#-%EA%B0%9C%EC%9A%94\">📚 개요</a></p>\n</li>\n<li>\n<p><a href=\"#-%EB%8F%99%EA%B8%B0\">🏁 동기</a></p>\n</li>\n<li>\n<p><a href=\"#-%EC%96%B4%EB%96%BB%EA%B2%8C-%EB%A7%8C%EB%93%A4%EA%B9%8C\">🤔 어떻게 만들까?</a></p>\n</li>\n<li>\n<p><a href=\"#-%EC%9C%84%EC%A0%AF-%EB%A7%8C%EB%93%A4%EA%B8%B0\">📣 위젯 만들기⁉</a></p>\n</li>\n<li>\n<p><a href=\"#-%EB%A1%9C%EA%B7%B8%EC%9D%B8%ED%95%98%EA%B8%B0\">📧 로그인하기</a></p>\n<ul>\n<li><a href=\"#%ED%95%9C%EA%B8%80-%EC%9D%B8%EC%BD%94%EB%94%A9-%EB%AC%B8%EC%A0%9C%EC%97%90-%EB%B6%80%EB%94%AA%ED%9E%88%EB%8B%A4\">한글 인코딩 문제에 부딪히다.</a></li>\n<li><a href=\"#%EB%AC%B8%EC%A0%9C-%EC%9B%90%EC%9D%B8\">문제 원인</a></li>\n<li><a href=\"#%EC%9E%84%EC%8B%9C%EB%B0%A9%ED%8E%B8%EC%9C%BC%EB%A1%9C-%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0\">임시방편으로 문제 해결…</a></li>\n<li><a href=\"#%EC%99%84%EC%A0%84-%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0-v2\">완전 문제 해결! (v.2)</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%EC%82%AC%EC%9A%A9%EB%9F%89-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0\">📂 사용량 가져오기</a></p>\n<ul>\n<li><a href=\"#%EC%82%AC%EC%9A%A9%EB%9F%89-%EB%B0%9B%EA%B8%B0\">사용량 받기</a></li>\n<li><a href=\"#%EC%82%AC%EC%9A%A9%EB%9F%89-%ED%8E%98%EC%9D%B4%EC%A7%80-%EB%B6%88%EB%9F%AC%EC%98%A4%EA%B8%B0\">사용량 페이지 불러오기</a></li>\n<li><a href=\"#%EC%82%AC%EC%9A%A9%EB%9F%89-%EC%B6%94%EC%B6%9C%ED%95%98%EA%B8%B0\">사용량 추출하기</a></li>\n<li><a href=\"#%EA%B2%B0%EA%B3%BC\">결과</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%EB%B0%9B%EC%95%84%EC%98%A8-%EC%82%AC%EC%9A%A9%EB%9F%89-%ED%95%B4%EC%84%9D%ED%95%98%EA%B8%B0\">📏 받아온 사용량 해석하기</a></p>\n<ul>\n<li><a href=\"#%EB%B0%B0%EC%97%B4-%EB%B6%84%EC%84%9D%ED%95%98%EA%B8%B0\">배열 분석하기</a></li>\n<li><a href=\"#%EA%B2%B0%EA%B3%BC-1\">결과</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%EC%B6%94%EA%B0%80%EC%A0%81%EC%9D%B8-%EA%B8%B0%EB%8A%A5-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0\">🦖 추가적인 기능 구현하기</a></p>\n<ul>\n<li><a href=\"#%EC%83%88%EB%A1%9C%EA%B3%A0%EC%B9%A8%EB%90%98%EB%8A%94-%EC%8B%9C%EA%B0%84-%ED%91%9C%EC%8B%9C\">새로고침되는 시간 표시</a></li>\n<li><a href=\"#%EC%88%98%EB%8F%99-%EC%83%88%EB%A1%9C%EA%B3%A0%EC%B9%A8-%EA%B8%B0%EB%8A%A5\">수동 새로고침 기능</a></li>\n<li><a href=\"#%EB%8B%A8%EC%B6%95%EC%96%B4%EB%A1%9C-%EC%9C%84%EC%A0%AF-%EC%84%A4%EC%B9%98-v2\">단축어로 위젯 설치 (v.2)</a></li>\n<li><a href=\"#%ED%82%A4%EC%B2%B4%EC%9D%B8-%ED%99%9C%EC%9A%A9%ED%95%98%EA%B8%B0-v2\">키체인 활용하기 (v.2)</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%EC%9C%84%EC%A0%AF-%EB%94%94%EC%9E%90%EC%9D%B8%ED%95%98%EA%B8%B0\">👀 위젯 디자인하기</a></p>\n<ul>\n<li><a href=\"#%EC%9C%84%EC%A0%AF-%EC%A2%85%EB%A5%98\">위젯 종류</a></li>\n<li><a href=\"#%EB%A7%8C%EB%93%A4%EA%B8%B0\">만들기</a></li>\n<li><a href=\"#%EA%B2%B0%EA%B3%BC-2\">결과</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%EB%A7%88%EB%AC%B4%EB%A6%AC\">🔖 마무리</a></p>\n</li>\n<li>\n<p><a href=\"#-%EB%B6%84%EC%84%9D-%EB%B0%B0%EC%9A%B4-%EC%A0%90\">💡 분석, 배운 점</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"August 09, 2021","title":"스마텔 알뜰폰 사용량 위젯","categories":"기록","author":"0w0i0n0g0","emoji":"📊"},"fields":{"slug":"/records-usage-widget-for-smartel/"}},"prev":null,"site":{"siteMetadata":{"siteUrl":"https://0w0i0n0g0.github.io","comments":{"utterances":{"repo":""}}}}},"pageContext":{"slug":"/records-cgv-open-push/","nextSlug":"/records-usage-widget-for-smartel/","prevSlug":""}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}